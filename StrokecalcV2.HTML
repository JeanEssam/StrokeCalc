<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .general-info {
            background-color: #ffdddd; /* red */
        }

        .required-facilities {
            background-color: #ddffdd; /* green */
        }

        .required-staff {
            background-color: #ddddff; /* blue */
        }

            /* ...existing styles... */

        .table-dccpa {
            background-color: #ffdddd; /* red */
        }

        .table-consultants {
            background-color: #ddffdd; /* green */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stroke Management Calculator Simulator </h1>
        <form id="stroke-form" onsubmit="event.preventDefault(); calculate()">
            <div class="form-group">
                <label for="cluster">Cluster Name:</label>
                <input type="text" class="form-control" id="cluster" pattern="[A-Za-z\s]+" required>
            </div>
            <div class="form-group">
                <label for="population">Population:</label>
                <input type="text" class="form-control" id="population" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, ',')" required>
            </div>
            <div class="form-group">
                <label for="cases">Number of Stroke Cases / 100,000 patient:     Example : " 75 Stroke Patient / 100,000 population ""</label>
                <input type="text" class="form-control" id="cases" pattern="[0-9]+" value="75" required>
            </div>
            <div class="form-group">
                <label for="HASUBedspatient">Hyper Acute Stroke Unit (HASU) Average Patient Days per bed Example : " 4 Days/Patient ""</label>
                <input type="text" class="form-control" id="HASUBedspatient" pattern="[0-9]+" value="4" required>
            </div>

            <div class="form-group">
                <label for="ASUBedspatient">Acute Stroke Unit (ASU) Average Patient Days per bed Example : " 5 Days/Patient "" </label>
                <input type="text" class="form-control" id="ASUBedspatient" pattern="[0-9]+" value="5" required>
            </div>

            <div class="form-group">
                <label for="rehabpatient">Estimated Rehab Patient Inpatient from strokepatient (Example : 21%)</label>
                <input type="text" class="form-control" id="rehabpatient" pattern="[0-9]+" value="21" required>
            </div>

            <div class="form-group">
                <label for="Inpatientrehabdays">Average Inpatient Rehab Days Example : " 14 Days / Patient" </label>
                <input type="text" class="form-control" id="Inpatientrehabdays" pattern="[0-9]+" value="14" required>
            </div>

            <div class="form-group">
                <label for="ltcpatient">Estimated LTC Patient from strokepatient (Example :7%)</label>
                <input type="text" class="form-control" id="ltcpatient" pattern="[0-9]+" value="7" required>
            </div>

            <div class="form-group">
                <label for="Inpatientltcdays">Average Inpatient LTC Days (Example : 90 Days/Patient)</label>
                <input type="text" class="form-control" id="Inpatientltcdays" pattern="[0-9]+" value="90" required>
            </div>

            <div class="form-group">
                <label for="StaffStrokeneurologistInterventional">Staff Stroke Consultant Ratio    Example : " 5 Patient / Consultant ""</label>
                <input type="text" class="form-control" id="StaffStrokeneurologistInterventional" pattern="[0-9]+" value="5" required>
            </div>

            <div class="form-group">
                <label for="Occupancy ">Occupancy % (Expamle : 80 ~ 85)</label>
                <input type="text" class="form-control" id="Occupancy " pattern="[0-9]+" value="85" required>
            </div>

            <button type="submit" class="btn btn-primary">Calculate</button>
        
        <table class="table table-active mt-3">
            <thead>
                <tr>
                    <th scope="col">Output</th>
                    <th scope="col">Value</th>
                </tr>
            </thead>
            <tbody id="results"></tbody>
        </table>
        <div class="mt-5">
            <canvas id="age-chart"></canvas>
        </div>

        <table class="table table-active mt-3">
            <thead>
                <tr>
                    <th colspan="12">Recommended Direct Clinical Care programmed activities (DCC PA) allocation
                        for different numbers of stroke admissions per year</th>
                </tr>
                <tr>
                    <th>Number of confirmed stroke admissions/year</th>
                    <th>Max - HASU Bed</th>
                    <th>Max - ASU / in-pt rehab Bed</th>
                    <th>Total beds</th>
                    <th>Hyper-acute (1st 72 hours)</th>
                    <th>Post Hyper-Acute ASU</th>
                    <th>Post Hyper-Acute Inpatient Rehab</th>
                    <th>TIA/OPD - TIA/Minor Stroke Clinic</th>
                    <th>TIA/OPD - Stroke F/UP</th>
                    <th>Additional activities (e.g. MDT meeting/case conference/family meeting, teaching)</th>
                    <th>Thrombolysis/front door assessment including stroke mimics</th>
                    <th>Additional PA for centres performing IAT</th>
                </tr>
                <tbody id="table-results"></tbody>
                <tr>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> 25<(8am-8pm, 7 days a week) 1 Consultant  </td>
                    <td>1 - 5 (daily ward round, 5 days, HASU cons cover at w/e)</td>
                    <td>1-3 (includes MDT meetings/family meetings and 2 WR’s per week)</td>
                    <td>1-5 (1 clinic a day M-F, weekend TIA work by HASU cons)</td>
                    <td>&lt;2 (Seen within TIA clinic template)</td>
                    <td>MDT meetings: 35%<br>Neurorad MDT: 25%<br>ESD/Community: 30%</td>
                    <td> 2 < Performed by HASU consultant </td>
                    <td> </td>
                </tr>
                <tr>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> 25>(8am-8pm, 7 days a week) 2f Consultant </td>
                    <td>1 - 5 (daily ward round, 5 days, HASU cons cover at w/e)</td>
                    <td>1-3 (includes MDT meetings/family meetings and 2 WR’s per week)</td>
                    <td>1-5 (1 clinic a day M-F, weekend TIA work by HASU cons)</td>
                    <td>&lt;2 (Seen within TIA clinic template)</td>
                    <td>MDT meetings: 35%<br>Neurorad MDT: 25%<br>ESD/Community: 30%</td>
                    <td> </td>
                    <td> </td>
                </tr>
                <tr>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td>5-7 (daily ward round, 7 days)</td>
                    <td>5-7 (includes MDT meetings/family meetings and 2 WR’s per week)</td>
                    <td>6-12 OPD (2xclinics per day M-F, 1 per day w/e) Triage: 2</td>
                    <td></td>
                    <td></td>
                    <td> </td>
                    <td> </td>
                </tr>
                <tr>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td> </td>
                    <td>&gt;12 (2x WR per day M-F, 2 WR’S over w/e)</td>
                    <td>&gt;7 (includes MDT meetings/family meetings and 2 WR’s per week)</td>
                    <td>12-17 OPD 3: triage (3xclinics per day, M-F, 1 per w/e)</td>
                    <td></td>
                    <td></td>
                    <td> </td>
                    <td> </td>
                </tr>
            </thead>
            
        </table>

        <table class="table table-active mt-3">
            <tbody>
                <tr>
                    <th>Total DCC PA Required:</th>
                    <td><span id="total-dccpa-value"></span></td>
                </tr>
            </tbody>
        </table>
        
        <table class="table table-active mt-3">
            <tbody>
                <tr>
                    <th>Number of Stroke Consultants:</th>
                    <td><span id="stroke-consultantsPA-value"></span></td>
                </tr>
            </tbody>
        </table>

        <h3>Methods, Considerations, and Assumptions</h3>
        <ol>
            <li>
                PA allocations assume that HASU / post-72 hours (incorporating in-patient rehabilitation) is all co-located at the same hospital. If parts of the stroke pathway are across split sites, PA allocations will need adjustments to reflect diversification of the provision of stroke care.
            </li>
            <li>
                The expectation is that HASU ward rounds and HASU cover by a Stroke Physician / senior decision maker is 8am-8pm, irrespective of the size of the unit. Smaller units will need only one consultant on duty at a given time. This consultant will also be able to see TIA patients and cover the HASU and ASU beds at weekends. However, it is envisaged that once a unit accepts more than 900 stroke patients a year, two consultants will be required at weekends to ensure the service is safely delivered and a true ‘7 day service’ is sustainable. Then larger units admitting more than 1,700 patients a year are likely to need a minimum of three consultants involved in HASU / ASU / front door assessment and TIA assessment at weekends.
            </li>
            <li>
                In some models of care, stroke follow-up clinics at around six weeks post-discharge may be delivered by others (e.g., stroke specialist nurses) and will be able to signpost back into the acute trusts as required. For the purposes of this calculation, we have assumed that 20% of stroke patients will need to be brought back for follow-up at the acute trust by a consultant-led service. It is essential that all stroke patients have a 6-month and then annual reviews, performed by a stroke-skilled practitioner; this has not been incorporated in the workforce calculations given the most appropriate individual is unlikely to be a stroke consultant.
            </li>
            <li>
                All new stroke referrals should be seen by a specialist – there will inevitably be a stroke mimic rate which will vary by center, a standard stroke mimic rate has been assumed.
            </li>
            <li>
                The following time assumptions were made for various elements of the pathway:
                <ul>
                    <li>IAT intervention centers only (7% rate): 4 hrs / patient</li>
                    <li>TIA activity, TIA Triage (including telephone call if required): 10 mins / patient</li>
                    <li>TIA ambulatory, clinic assessment: 50 mins / patient</li>
                    <li>Thrombolysis calls:
                        <ul>
                            <li>Patients who require referral for IAT: 2 hrs / patient</li>
                            <li>Patients who require IV thrombolysis only: 40 mins / patient</li>
                            <li>Patients with a confirmed stroke who do not require thrombolysis, or mimics: 20 mins / patient</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                Ward rounds:
                <ul>
                    <li>Twice daily (7 days a week) HASU ward rounds (e.g., first 72 hrs):
                        <ul>
                            <li>First review = 40 mins per patient, subsequent reviews 10 mins / patient</li>
                        </ul>
                    </li>
                    <li>Once daily (5 days a week) ASU ward round (e.g., day 3 to day 10):
                        <ul>
                            <li>First review = 20 mins per patient, subsequent reviews 15 mins / patient</li>
                        </ul>
                    </li>
                    <li>Once daily (5 days a week) Inpatient hospital stroke-specific rehabilitation ward rounds:
                        <ul>
                            <li>First review = 20 mins / patient, subsequent reviews 10 mins / patient</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                Additional specialist ward rounds:
                <ul>
                    <li>Once weekly feeding round (25% all patients): 10 mins / patient</li>
                    <li>Daily (7 days a week) safety round (all patients: i.e., VTE/Falls, etc.): 5 mins / patient</li>
                    <li>Attendance at MDT Board Rounds:
                        <ul>
                            <li>Twice daily (7 days a week) HASU MDR: 1 min / patient</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                Stroke Outreach reviews (i.e., orthopedic wards, intensive therapy units, and coronary care units):
                <ul>
                    <li>1 / day / 600 confirmed stroke admissions / year: 30 mins / patient</li>
                </ul>
            </li>
            <li>
                Communication and goal setting:
                <ul>
                    <li>Once weekly MDT meeting: 10 mins per patient</li>
                    <li>Next of kin discussions / meeting (all patients: once): 20 mins / patient</li>
                </ul>
            </li>
            <li>
                Clinical governance:
                <ul>
                    <li>Neuro-Radiology review (MDT) of all confirmed strokes (10 mins per patient) and TIA with vessel imaging (3 mins per patient)</li>
                </ul>
            </li>
            <li>
                Other clinical activity:
                <ul>
                    <li>Once weekly community stroke team liaison: 1 hr / 150 patients / year discharges</li>
                    <li>Medically required OPD reviews (20% total discharges): 1 hr / 100 discharges / year</li>
                </ul>
            </li>
        </ol>

</form>
        
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

        

        function calculateHASU(strokePatients, HASUBedspatient, Occupancy ) {
            // Calculate the number of Hyper Acute Stroke Unit (HASU) beds required
            // Equation: hasu = hasu * HASUBedspatient / 365 * Occupancy 
            var hasu = strokePatients * HASUBedspatient / 365 * Occupancy ;
            return Math.round(hasu);
        }

        function calculateASU(strokePatients, ASUBedspatient, Occupancy ) {
            // Calculate the number of Acute Stroke Unit (ASU) beds required
            // Equation: asu = asu * ASUBedspatient / 265 * Occupancy 
            var asu = strokePatients * ASUBedspatient / 365 * Occupancy ;
            return Math.round(asu);
        }

        function calculateRehab(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays ) {
            // Calculate the number of rehab facilities required
            // Equation: rehab = rehab * 14 * 0.2 / 365 * Occupancy 
            var rehab = (strokePatients * rehabpatient * Inpatientrehabdays) / 365 * Occupancy ;
            return Math.round(rehab);
        }

        function calculateLTC(strokePatients, Inpatientltcdays , ltcpatient , Occupancy ) {
            // Calculate the number of Long Term Care (LTC) facilities required
            // Equation: ltc = ltc * Inpatientltcdays * ltcpatient  / 365 * Occupancy 
            var ltc = (strokePatients * Inpatientltcdays * ltcpatient) / 365 * Occupancy ;
            return Math.round(ltc);
        }

        function calculateNeurologistStaff(strokePatients, HASUBedspatient, Occupancy  ,StaffStrokeneurologistInterventional) {
        // Calculate the number of staff Stroke Neurologist/Interventional Neuroradiologist required
        var staff = Math.round(calculateHASU(strokePatients, HASUBedspatient, Occupancy ) / StaffStrokeneurologistInterventional);
        if (staff <= 3) {
                return 3;
            } else {
                return staff;
            }
         }

       
        function calculatePhysicianHASU(strokePatients, HASUBedspatient, Occupancy ) {
            // Calculate the number of Physical Medicine and Rehabilitation physician (HASU) required
            // Equation: physicianHASU = hasu * 0.084
            var physicianHASU = calculateHASU(strokePatients, HASUBedspatient, Occupancy ) * 0.084;
            if (physicianHASU <= 1) {
                return 1;
            } else {
                return  Math.round(physicianHASU);
            }
          
        }

        function calculatePhysicianASU(strokePatients, ASUBedspatient, Occupancy ) {
            // Calculate the number of Physical Medicine and Rehabilitation physician (ASU) required
            // Equation: physicianASU = asu * 0.084
            var physicianASU = calculateASU(strokePatients, ASUBedspatient, Occupancy ) * 0.084;
            if (physicianASU <= 1) {
                return 1;
            } else {
                return  Math.round(physicianASU);
            }
           
        }

        function calculatePhysicalTherapistHASU(strokePatients, HASUBedspatient, Occupancy ) {
            // Calculate the number of Physical Therapist (HASU) required
            // Equation: therapistHASU = hasu * 0.73 / 5
            var therapistHASU = calculateHASU(strokePatients, HASUBedspatient, Occupancy ) * 0.73 / 5;
            if (therapistHASU <= 1) {
                return 1;
            } else {
                return  Math.round(therapistHASU);
            }
            
        }

        function calculatePhysicalTherapistASU(strokePatients, ASUBedspatient, Occupancy ) {
            // Calculate the number of Physical Therapist (ASU) required
            // Equation: therapistASU = asu * 0.84 / 5
            var therapistASU = calculateASU(strokePatients, ASUBedspatient, Occupancy ) * 0.84 / 5;
            if (therapistASU <= 1) {
                return 1;
            } else {
                return  Math.round(therapistASU);
            }
            
        }

        function calculatePhysicalTherapistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) {
            // Calculate the number of Physical Therapist (IPR) required
            // Equation: therapistIPR = rehab / 5
            var therapistIPR = calculateRehab(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) / 5;
            if (therapistIPR <= 1) {
                return 1;
            } else {
                return  Math.round(therapistIPR);
            }

        }

        function calculateOccupationalTherapistHASU(strokePatients, HASUBedspatient, Occupancy ) {
            // Calculate the number of Occupational Therapist (HASU) required
            // Equation: therapistHASU = hasu * 0.68 / 5
            var therapistHASU = calculateHASU(strokePatients, HASUBedspatient, Occupancy ) * 0.68 / 5;

            if (therapistHASU <= 1) {
                return 1;
            } else {
                return  Math.round(therapistHASU);
            }
          
        }

        function calculateOccupationalTherapistASU(strokePatients, ASUBedspatient, Occupancy ) {
            // Calculate the number of Occupational Therapist (ASU) required
            // Equation: therapistASU = asu * 0.81 / 5
            var therapistASU = calculateASU(strokePatients, ASUBedspatient, Occupancy ) * 0.81 / 5;
           
            if (therapistASU <= 1) {
                return 1;
            } else {
                return  Math.round(therapistASU);
            }
            
        }

        function calculateOccupationalTherapistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) {
            // Calculate the number of Occupational Therapist (IPR) required
            // Equation: therapistIPR = rehab / 5
            var therapistIPR = calculateRehab(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) / 5;

            if (therapistIPR <= 1) {
                return 1;
            } else {
                return  Math.round(therapistIPR);
            }
        }

        function calculateSpeechTherapistHASU(strokePatients, HASUBedspatient, Occupancy ) {
            // Calculate the number of Speech and Language Therapist (HASU) required
            // Equation: therapistHASU = hasu * 0.34 / 5
            var therapistHASU = calculateHASU(strokePatients, HASUBedspatient, Occupancy ) * 0.34 / 5;
            if (therapistHASU <= 1) {
                return 1;
            } else {
                return  Math.round(therapistHASU);
            }
        }

        function calculateSpeechTherapistASU(strokePatients, ASUBedspatient, Occupancy ) {
            // Calculate the number of Speech and Language Therapist (ASU) required
            // Equation: therapistASU = asu * 0.4 / 5
            var therapistASU = calculateASU(strokePatients, ASUBedspatient, Occupancy ) * 0.4 / 5;
            if (therapistASU <= 1) {
                return 1;
            } else {
                return  Math.round(therapistASU);
            }
            
        }

        function calculateSpeechTherapistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) {
            // Calculate the number of Speech and Language Therapist (IPR) required
            // Equation: therapistIPR = rehab * 0.75 / 5
            var therapistIPR = calculateRehab(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) * 0.75 / 5;
          
            if (therapistIPR <= 1) {
                return 1;
            } else {
                return  Math.round(therapistIPR);
            }
        }

        function calculatePsychologistHASU(strokePatients, HASUBedspatient, Occupancy ) {
            // Calculate the number of Psychologist (HASU) required
            // Equation: psychologistHASU = hasu * 0.2 / 5
            var psychologistHASU = calculateHASU(strokePatients, HASUBedspatient, Occupancy ) * 0.2 / 5;
            if (psychologistHASU <= 1) {
                return 1;
            } else {
                return  Math.round(psychologistHASU);
            }
           
        }

        function calculatePsychologistASU(strokePatients, ASUBedspatient, Occupancy ) {
            // Calculate the number of Psychologist (ASU) required
            // Equation: psychologistASU = asu * 0.2 / 5
            var psychologistASU = calculateASU(strokePatients, ASUBedspatient, Occupancy ) * 0.2 / 5;
        
            if (psychologistASU <= 1) {
                return 1;
            } else {
                return  Math.round(psychologistASU);
            }
        }

        function calculatePsychologistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) {
            // Calculate the number of Psychologist (IPR) required
            // Equation: psychologistIPR = rehab * 0.2 / 5
            var psychologistIPR = calculateRehab(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays) * 0.2 / 5;
            if (psychologistIPR <= 1) {
                return 1;
            } else {
                return  Math.round(psychologistIPR);
            }
  
        }

        function calculate() {
            var cluster = document.getElementById('cluster').value;
            var population = Number(document.getElementById('population').value.replace(/,/g, ''));
            var cases = Number(document.getElementById('cases').value);
            var HASUBedspatient = Number(document.getElementById('HASUBedspatient').value);
            var ASUBedspatient = Number(document.getElementById('ASUBedspatient').value);
            var Occupancy  = Math.round(Number(document.getElementById('Occupancy ').value))/100;
            var rehabpatient = Math.round(Number(document.getElementById('rehabpatient').value))/100;            
            var Inpatientrehabdays = Number(document.getElementById('Inpatientrehabdays').value);
            var ltcpatient = Math.round(Number(document.getElementById('ltcpatient').value))/100;            
            var Inpatientltcdays = Number(document.getElementById('Inpatientltcdays').value);
            var StaffStrokeneurologistInterventional = Number(document.getElementById('StaffStrokeneurologistInterventional').value);

            var results = {}; // Declare the results object here

            var strokePatients = Math.round((cases / 100000) * population);
            var strokePatientsdischargehome= Math.round(0.8 * (cases / 100000) * population);
            var strokePatientsdischargeDeath= Math.round(0.03 * (cases / 100000) * population);
            var strokePatientsIVTPA = Math.round(0.2 * (cases / 100000) * population);
            var strokePatientsMT = Math.round(0.13 * (cases / 100000) * population);
            var strokePatientsMTStaffInterventional = Math.round((0.13 * (cases / 100000) * population )/25);
            
                    if (strokePatientsMTStaffInterventional <= 1) {
                    strokePatientsMTStaffInterventional = 1;
                    }

            var strokePatients10YearExpe = Math.round(10 * (cases / 100000) * population);
            
            var ageDistribution = {
                '0-19': Math.round(0.01 * strokePatients),
                '20-39': Math.round(0.05 * strokePatients),
                '40-59': Math.round(0.45 * strokePatients),
                '60-79': Math.round(0.40 * strokePatients),
                '80 and above': Math.round(0.09 * strokePatients)
            };
            

            var results = {
                "Cluster": cluster,
                "Population": population.toLocaleString(),
                "Estimated Stroke Patient / Year ": strokePatients.toLocaleString(),
                "expected IV TPA @ 20% ": strokePatientsIVTPA.toLocaleString(),
                "expected MT @ 13% ": strokePatientsMT.toLocaleString(),
                "expected Discharge Home ": strokePatientsdischargehome.toLocaleString(),
                "expected Discharge Death ": strokePatientsdischargeDeath.toLocaleString(),
                "10 Year expected ": strokePatients10YearExpe.toLocaleString(),
                "Hyper Acute Stroke unit Beds (HASU) Required": calculateHASU(strokePatients, HASUBedspatient, Occupancy ).toLocaleString(),
                "Acute Stroke Unit Beds(ASU) Required": calculateASU(strokePatients, ASUBedspatient, Occupancy ).toLocaleString(),
                "Rehab Inpatient Required": calculateRehab(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays).toLocaleString(),
                "Long Term Care (LTC) Required": calculateLTC(strokePatients, Inpatientltcdays , ltcpatient , Occupancy ).toLocaleString(),
                "Staff Stroke : Neuro Consultant ": calculateNeurologistStaff(strokePatients, HASUBedspatient, Occupancy  ,StaffStrokeneurologistInterventional).toLocaleString(),
                "Staff Stroke : Neuro Interventional ": strokePatientsMTStaffInterventional.toLocaleString(),

                "Physical medicine and Rehabilitation physician HASU": calculatePhysicianHASU(strokePatients, HASUBedspatient, Occupancy ).toLocaleString(),
                "Physical medicine and Rehabilitation physician ASU": calculatePhysicianASU(strokePatients, ASUBedspatient, Occupancy ).toLocaleString(),
                "Physical therapist HASU": calculatePhysicalTherapistHASU(strokePatients, HASUBedspatient, Occupancy ).toLocaleString(),
                "Physical therapist ASU": calculatePhysicalTherapistASU(strokePatients, ASUBedspatient, Occupancy ).toLocaleString(),
                "Physical therapist IPR": calculatePhysicalTherapistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays).toLocaleString(),
                "Occupational therapist HASU": calculateOccupationalTherapistHASU(strokePatients, HASUBedspatient, Occupancy ).toLocaleString(),
                "Occupational therapist ASU": calculateOccupationalTherapistASU(strokePatients, ASUBedspatient, Occupancy ).toLocaleString(),
                "Occupational therapist IPR": calculateOccupationalTherapistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays).toLocaleString(),
                "Speech and language therapist HASU": calculateSpeechTherapistHASU(strokePatients, HASUBedspatient, Occupancy ).toLocaleString(),
                "Speech and language therapist ASU": calculateSpeechTherapistASU(strokePatients, ASUBedspatient, Occupancy ).toLocaleString(),
                "Speech and language therapist IPR": calculateSpeechTherapistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays).toLocaleString(),
                "Psychologist HASU": calculatePsychologistHASU(strokePatients, HASUBedspatient, Occupancy ).toLocaleString(),
                "Psychologist ASU": calculatePsychologistASU(strokePatients, ASUBedspatient, Occupancy ).toLocaleString(),
                "Psychologist IPR": calculatePsychologistIPR(strokePatients, Occupancy  ,rehabpatient , Inpatientrehabdays).toLocaleString(),

                


                
            };

            var results2 = {
                "Number of confirmed stroke admissions/year": strokePatients.toLocaleString(),
                "Max - HASU Bed": Math.round(((0.0100549 * strokePatients ) + 2.26923)).toLocaleString(),
                "Max - ASU / in-pt rehab Bed": Math.round((0.03 * strokePatients + 1)).toLocaleString(),
                "Total beds": Math.round(((0.0400549 * strokePatients ) + 3.26923)).toLocaleString(),
                "Hyper-acute(1st 72 hours)": Math.round(((0.0105495 * strokePatients) + 14.6923)).toLocaleString(),
                "Post Hyper-Acute ASU": Math.round(((0.00626374 * strokePatients) + 0.692308)).toLocaleString(),
                "Post Hyper-Acute Inpatient Rehab": Math.round((0.00362637 * strokePatients + 0.769231)).toLocaleString(),
                "TIA/OPD - TIA/Minor Stroke Clinic": Math.round(((0.0109341 * strokePatients) - 1.42308)).toLocaleString(),
                "TIA/OPD - Stroke F/UP": Math.round(((0.00362637 * strokePatients) - 1.23077)).toLocaleString(),
                "Additional activities (e.g. MDT meeting/case conference/family meeting, teaching)": Math.round(((0.00543956 * strokePatients) - 0.346154)).toLocaleString(),
                "Thrombolysis/front door assessment including stroke mimics": Math.round(((0.00868132 * strokePatients) - 3.96154)).toLocaleString(),
                "Additional PA for centres performing IAT": ((0.00245604 * strokePatients) + 0.0346154).toFixed(2)


            };

            var totalDCCPA = Math.ceil(
                ((0.0105495 * strokePatients) + 14.6923) +
                ((0.00626374 * strokePatients) + 0.692308) +
                (0.00362637 * strokePatients + 0.769231) +
                ((0.0109341 * strokePatients) - 1.42308) +
                ((0.00362637 * strokePatients) - 1.23077) + 
                ((0.00543956 * strokePatients) - 0.346154) +
                ((0.00868132 * strokePatients) - 3.96154) +
                ((0.00245604 * strokePatients) + 0.0346154)

            ).toFixed(0);

            var strokeConsultantsPA = Math.round(((
                ((0.0105495 * strokePatients) + 14.6923) +
                ((0.00626374 * strokePatients) + 0.692308) +
                (0.00362637 * strokePatients + 0.769231) +
                ((0.0109341 * strokePatients) - 1.42308) +
                ((0.00362637 * strokePatients) - 1.23077) + 
                ((0.00543956 * strokePatients) - 0.346154) +
                ((0.00868132 * strokePatients) - 3.96154) +
                ((0.00245604 * strokePatients) + 0.0346154)

            )/7.9646));

            


            var resultsElement = document.getElementById('results');
            resultsElement.innerHTML = '';

            var generalInfo = ["Cluster", "Population", "Estimated Stroke Patient / Year ","expected IV TPA @ 20% " ,  "expected MT @ 13% " , "10 Year expected " ,"expected Discharge Home ","expected Discharge Death "];
            var requiredFacilities = ["Hyper Acute Stroke unit Beds (HASU) Required", "Acute Stroke Unit Beds(ASU) Required", "Rehab Inpatient Required", "Long Term Care (LTC) Required"];

            for (var key in results) {
                var row = document.createElement('tr');
                if (generalInfo.includes(key)) {
                    row.className = 'general-info';
                } else if (requiredFacilities.includes(key)) {
                    row.className = 'required-facilities';
                } else {
                    row.className = 'required-staff';
                }

                var outputCell = document.createElement('td');
                outputCell.textContent = key;
                row.appendChild(outputCell);

                var valueCell = document.createElement('td');
                valueCell.textContent = results[key];
                row.appendChild(valueCell);

                resultsElement.appendChild(row);
            }



            // Update total DCC PA value
            var totalDCCPAValue = document.getElementById('total-dccpa-value');
            totalDCCPAValue.textContent = totalDCCPA;

            // Set class for total DCC PA row
            var totalDCCPARow = totalDCCPAValue.closest('tr');
            totalDCCPARow.className = 'table-dccpa';

            // Update Stroke Consultants value
            var strokeConsultantsCell = document.getElementById('stroke-consultantsPA-value');
            strokeConsultantsCell.textContent = strokeConsultantsPA;

            // Set class for Stroke Consultants row
            var strokeConsultantsRow = strokeConsultantsCell.closest('tr');
            strokeConsultantsRow.className = 'table-consultants';




            var ageChartCanvas = document.getElementById('age-chart');
            var ageChart = new Chart(ageChartCanvas, {
                type: 'bar',
                data: {
                    labels: Object.keys(ageDistribution),
                    datasets: [{
                        label: 'Distribution of Stroke by Age',
                        data: Object.values(ageDistribution),
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Patients'
                            }
                        }
                    }
                }
            });
            
            var tableResultsElement = document.getElementById('table-results');
            tableResultsElement.innerHTML = '';

            var tableRow = document.createElement('tr');
            tableResultsElement.appendChild(tableRow);

            var formulasRow = document.createElement('tr');
            tableResultsElement.appendChild(formulasRow);

            var counter = 0;
            for (var key in results2) {
                var tableDataCell = document.createElement('td');
                tableDataCell.textContent = results2[key];
                tableRow.appendChild(tableDataCell);



                counter++;
                if (counter === 12) {
                    tableRow = document.createElement('tr');
                    tableResultsElement.appendChild(tableRow);

                    formulasRow = document.createElement('tr');
                    tableResultsElement.appendChild(formulasRow);

                    counter = 0;
                }
            }

            // Add notes as comments
            var notesContainer = document.createElement('div');
            notesContainer.className = 'notes';

            var notesText = document.createElement('p');
            notesText.textContent = ' Programmed activity (PA) :';
            notesContainer.appendChild(notesText);

            var notesList = document.createElement('ul');
            notesContainer.appendChild(notesList);

            var notesItems = [
            'In order to reflect stroke specialist activity irrespective of service configuration, we have based our workforce estimations upon the number of consultant sessions (DCC PAs) required to meet current national care quality indicators and standards. DCC has been divided into hyper acute care (first 72 hours), post hyper acute care, Out Patient Department (OPD), additional activities, front door assessment (including mimics) and finally an additional tariff for centres performing intra-arterial thrombectomy. This subdivision has been applied so that the data are relevant to all centres caring for stroke patients. The table on the following page shows the numbers of DCC PAs required to provide a comprehensive dedicated stroke service that meets current standards of clinical care, for Stroke Units admitting 600, 1,200 and 1,700 stroke patients per year.',
            'Supporting programmed activity (SPA) includes:',
            'Audit and service development',
            'Clinical governance',
            'Continuing professional education',
            'Staff training',
            'Trainee and non-medical specialist staff supervision',
            'Service development, including introduction of emerging therapies and support for clinical research'
            ];

            notesItems.forEach(function (item) {
            var listItem = document.createElement('li');
            listItem.textContent = item;
            notesList.appendChild(listItem);
            });

            // Append notes after the bar chart container
            var chartContainer = document.getElementById('age-chart').parentNode;
            chartContainer.parentNode.insertBefore(notesContainer, chartContainer.nextSibling);


        
        }
    </script>
</body>
</html>
